<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="/assets/style.css" />

  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
</head>

<body>
  <div data-layer="confirmar" class="Step55">
    <div data-layer="wrapper" class="Wrapper">
      <div data-layer="header" class="Header">
        <div data-layer="logo" class="Logo">
          <div data-layer="datalpine" class="Datalpine">
            <img data-layer="logo_image" class="LogoImage" src="..\tools\logo.png" />
            <img data-layer="DatLogo" class="Datlogo" src="..\tools\DatLogo.png" />
          </div>
        </div>
        <a href="https://datalpine.mx/exploradores/" data-layer="Primary BTN" class="PrimaryBtn">
          <div data-layer="Button Text" class="ButtonText">Exploradores</div>
        </a>
      </div>
    </div>
    <div data-layer="form_step" class="FormStep111">
      <div data-layer="titulo" class="Titulo">Confirmar solicitud</div>
      <div data-layer="desc" class="DescText  TextWidth">
        ¿Está seguro de realizar el envío de su información?
      </div>
      <div data-layer="step_form" class="StepForm FinForm">
        <div data-layer="progreso" class="ProgresoConfirmYes FinProgreso">
          <div data-layer=" steps" class="Steps">
            <div data-layer="step1_bar" class="Step1BarC"></div>
            <div data-layer="step2_bar" class="Step2BarC"></div>
            <div data-layer="step3_bar" class="Step3BarC"></div>
            <div data-layer="step1_progreso" class="Step1Progreso">
              <div data-layer="Ellipse 435" class="Ellipse435 Ellipse435Morado"></div>
              <div data-layer="1" class="numberOne numberOneMorado">
                <p>1</p>
              </div>
            </div>
            <div data-layer="step2_progreso" class="Step2Progreso">
              <div data-layer="Ellipse 436" class="Ellipse438 Ellipse436Morado"></div>
              <div data-layer="2" class="TwoC numberTwoMorado">
                <p>2</p>
              </div>
            </div>
            <div data-layer="step3_progreso" class="Step3Progreso">
              <div data-layer="Ellipse 437" class="Ellipse439 Ellipse439Morado"></div>
              <div data-layer="3" class="TreeC numberTreeMorado">
                <p>3</p>
              </div>
            </div>
            <div data-layer="step4_progreso" class="Step4Progreso">
              <div data-layer="Ellipse 437" class="Ellipse441"></div>
              <div data-layer="4" class="NumberFour">
                <p>4</p>
              </div>
              <div data-layer="4" class="NumberFour numberFourMorado">
                <p>4</p>
              </div>
            </div>
          </div>
        </div>
        <div data-layer="line" class="Line"></div>
        <br />
        <div data-layer="icon_confirm" class="IconConfirm">
          <div data-layer="icon" class="Icon">
            <div data-layer="Rectangle 4343" class="Rectangle4343"></div>
            <div data-layer="Rectangle 4345" class="Rectangle4345"></div>
            <div data-layer="Rectangle 4344" class="Rectangle4344"></div>
            <div data-layer="Rectangle 4346" class="Rectangle4346"></div>
            <div data-layer="clock" class="Clock">
              <i class="bi bi-clock-history"></i>
            </div>
          </div>
        </div>

        <div data-layer="text_modal" class="TextModal">
          <div data-layer="desc" class="Desc">
            Tenga en cuenta que el procesamiento de su solicitud puede tomar
            un tiempo, pero nos comprometemos a responderle lo antes posible.
          </div>
          <div data-layer="titulo" class="Titulo">
            ¡Gracias por su confianza!
          </div>
          <br />
        </div>

        <a href="/form/step6.html" data-layer="Primary BTN" id="btnEnviar" class="PrimaryBtn">
          <div data-layer="Button Text" class="ButtonText">Enviar</div>
        </a>

        <br />
      </div>
      <div data-layer="navigation" class="Navigation">
        <a href="/form/step4.html" data-layer="Secondary BTN" class="SecondaryBtn">
          <div data-layer="Button Text" class="ButtonTextWhite">Anterior</div>
        </a>
      </div>
    </div>
  </div>



  <style>
  .swal2-popup {
    border-radius: 20px !important;
    font-family: 'DM Sans', sans-serif !important;
  }

  .swal2-title {
    font-weight: 700;
  }

  .swal2-html-container {
    font-weight: 400;
  }

  .swal2-confirm {
    border-radius: 8px !important;
    padding: 10px 20px;
    font-family: 'DM Sans', sans-serif;
  }
</style>


  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


 <script>
  document.getElementById('btnEnviar').addEventListener('click', async e => {
    e.preventDefault();

    const orden = [
      'nombre', 'Dedication', 'prefijo', 'numerotelefono', 'email',
      'razon', 'DescribeRazon', 'tipo_propiedad', 'tipovienda', 'cp',
      'estado', 'municipio', 'localidad', 'Condición', 'EstadoCasa', 'colonia', 'numero',
      'AnoConstruccion', 'mTerreno', 'mConstruccion', 'Recamaras',
      'Estacionamiento', 'Banos', 'mediobano', 'amenidades', 'Precio', 'Moneda'
    ];

    const datos = {};

    for (const key of orden) {
      const v = sessionStorage.getItem(key);
      if (v !== null) datos[key] = v;
    }

    const direccionData = sessionStorage.getItem("direccionData");
    if (direccionData) {
      const parsed = JSON.parse(direccionData);
      ['cp', 'estado', 'municipio', 'localidad', 'colonia', 'numero', 'calle'].forEach(k => {
        if (parsed[k]) datos[k] = parsed[k];
      });
    }

    const mapCoords = sessionStorage.getItem("mapCoords");
    if (mapCoords) {
      const { lat, lon } = JSON.parse(mapCoords);
      datos.latitud = lat;
      datos.longitud = lon;
    }

    datos.fotos = JSON.parse(sessionStorage.getItem('fotos') || '[]');
    datos.apoyos = JSON.parse(sessionStorage.getItem('apoyos') || '[]');

    try {
      const resp = await fetch('../propiedades/guardar.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
      });
      const j = await resp.json();

      if (j.ok) {
        await Swal.fire({
          icon: 'success',
          title: '¡Guardado exitosamente!',
          text: `Guardado en propiedades/${j.archivo}`,
          confirmButtonText: 'OK',
          showClass: {
            popup: 'animate__animated animate__fadeInDown'
          },
          hideClass: {
            popup: 'animate__animated animate__fadeOutUp'
          }
        });
        sessionStorage.clear();
        window.location.href = "/form/step6.html";
      } else {
        throw new Error(j.error);
      }
    } catch (err) {
      console.error(err);
      await Swal.fire({
        icon: 'error',
        title: 'Error',
        text: 'Error guardando metadatos.',
        confirmButtonText: 'OK',
        showClass: {
          popup: 'animate__animated animate__shakeX'
        },
        hideClass: {
          popup: 'animate__animated animate__fadeOutUp'
        }
      });
    }
  });
</script>



</body>

</html>